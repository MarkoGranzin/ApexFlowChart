var flow=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(t){e.isAPEX()&&apex.debug.info(t)},error:function(t){e.isAPEX()?apex.debug.error(t):console.error(t)}},groupObjectArray:function(e,t){return e&&Array.isArray(e)?e.reduce(function(e,n){return n[t]&&(e[n[t]]=e[n[t]]||[]).push(n),s,e},{}):[]},link:function(e){return window.location=e},escapeHTML:function(t){if(null===t)return null;if(void 0!==t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(t)):(t=String(t)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},loader:{start:function(t){if(e.isAPEX())apex.util.showSpinner($(t));else{var n=$("<span></span>");n.attr("id","loader"+t),n.addClass("ct-loader");var r=$("<i></i>");r.addClass("fa fa-refresh fa-2x fa-anim-spin"),r.css("background","rgba(121,121,121,0.6)"),r.css("border-radius","100%"),r.css("padding","15px"),r.css("color","white"),n.append(r),$(t).append(n)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(t,n){var r={};if("string"==typeof n)try{n=JSON.parse(n)}catch(t){e.debug.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),e.debug.error(t),e.debug.error(n)}else r=n;try{r=$.extend(!0,t,n)}catch(n){e.debug.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),e.debug.error(n),r=t,e.debug.error(r)}return r},noDataMessage:{show:function(e,t){var n=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),r=$("<div></div>"),i=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");r.append(i);var a=$("<span></span>").text(t).css("display","block").css("color","#707070").css("font-size","12px");n.append(r).append(a),$(e).append(n)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},cutString:function(e,t){try{return t<0?e:e.length>t?e.substring(0,t-3)+"...":e}catch(t){return e}}};return{initialize:function(t,n,r,i,a,s){function o(t){h.parent=u.getDefaultParent(),u.removeCells(u.getChildVertices(u.getDefaultParent())),u.getModel().beginUpdate();try{$.each(t,function(t,n){var r=n.parent;null!=r&&0==r.length||(r="parent");var i=mxUtils.createXmlDocument().createElement("UserObject");switch(i.setAttribute("label",n.VALUE),n.TYPE.toLowerCase()){case"vertex":!function(t,n,r,i,a,s,o,l,d){e.debug.info("setVertex(vertexId "+t+", parentVertexName "+n+", value "+r+", x "+i+",  y "+a+", width "+s+", height "+o+", style "+l+", connectable "+d+")"),h[t]=u.insertVertex(h[n],t,r,i,a,s,o,l),h[t].setConnectable(d)}(n.ID,r,i,n.X,n.Y,n.WIDTH,n.HEIGHT,n.STYLE,n.CONNECTABLE);break;case"edge":!function(t,n,r,i,a,s){e.debug.info("setEdge(edgeId "+t+", parentVertexId "+n+", value "+r+", sourceVertexId "+i+", targetVertexId "+a+", style "+s+")"),u.insertEdge(h[n],t,r,h[i],h[a],s)}(n.ID,r,i,n.SOURCE,n.TARGET,n.STYLE);break;default:alert("Invalid type only edge and vertex is supported")}})}finally{u.getModel().endUpdate(),l()}}function l(){$(g).is(":visible")&&(u.fit(null,!1,0,!0,!1,!1,.8*$(window).height()),u.view.rendering=!0,u.refresh())}function d(){if(e.isAPEX()){c.refreshIcon&&e.loader.start(g);var t=i;apex.server.plugin(n,{pageItems:t},{success:function(t){o(t.row),c.refreshIcon&&e.loader.stop(g)},error:function(t){$(g).empty(),e.noDataMessage.show(g,"Loading Data Error!"),c.refreshIcon&&e.loader.stop(g),e.debug.error(t.responseText)},dataType:"json"})}else s?o(s):e.debug.error("No offline Data found or apex and ajax id is unedefined.")}var u=null,c=e.jsonSaveExtend({refresh:0,refreshIcon:!0,style:[{name:"default",vertexstyle:{shape:"rectangle",perimeter:"rectanglePerimeter",strokeColor:"gray",rounded:!0,fillColor:"#EEEEEE",align:"center",verticalAlign:"middle",fontSize:"12",fontStyle:1,fontColor:"black"},edgestyle:{strokeColor:"#0C0C0C",fontColor:"black",labelBackgroundColor:"white",rounded:!0,fontSize:"10"}}]},r),g="#"+t,f=$(g),p=function(e){var t=$("<div></div>");return t.attr("id",g+"-c"),t.css("min-height","100px"),e.append(t),t}(f)[0],h=[];if(!mxClient.isBrowserSupported())return mxUtils.error("Browser is not supported!",200,!1);mxEvent.disableContextMenu(p),u=new mxGraph(p),function(){var t=u.getStylesheet().getDefaultVertexStyle(),n=jsonPath(c,'$.style[?(@.name=="default")]')[0];!function(t,n){$.each(n.vertexstyle,function(e,n){t[e]=n}),e.debug.info("setDefaultStyle: default"),e.debug.info(t),u.getStylesheet().putDefaultVertexStyle(t)}(t,n);var r=jsonPath(c,'$.style[?(@.name !="default" && @.vertexstyle)]');$.each(r,function(n,r){!function(t,n){t=mxUtils.clone(t),$.each(n.vertexstyle,function(e,n){t[e]=n}),u.getStylesheet().putCellStyle(n.name,t),e.debug.info("setStyle: "+n.name),e.debug.info(t)}(t,r)}),t=u.getStylesheet().getDefaultEdgeStyle(),$.each(n.edgestyle,function(e,n){t[e]=n}),t[mxConstants.STYLE_EDGE]=mxEdgeStyle.ElbowConnector,u.getStylesheet().putDefaultEdgeStyle(t);var i=jsonPath(c,'$.style[?(@.name !="default" && @.edgestyle)]');$.each(i,function(n,r){!function(t,n){t=mxUtils.clone(t),$.each(n.edgestyle,function(e,n){t[e]=n}),u.getStylesheet().putCellStyle(n.name,t),e.debug.info("setEdgeStyle: "+n.name),e.debug.info(t)}(t,r)})}(),u.setConnectable(!0),u.setAllowDanglingEdges(!1),u.setEnabled(!1),u.addListener(mxEvent.CLICK,function(t,n){var r=n.getProperty("cell");null!=r&&(1==r.vertex&&(e.debug.info("VertexClicked: "+r.id),e.isAPEX()?apex.event.trigger(p,"VertexClicked",r.id):$.event.trigger({type:"VertexClicked",message:r.id})),1==r.edge&&(e.debug.info("EdgeClicked: "+r.id),e.isAPEX()?apex.event.trigger(p,"EdgeClicked",r.id):$.event.trigger({type:"EdgeClicked",message:r.id})))}),u.setHtmlLabels(!0),u.convertValueToString=function(e){if(null!=e.div)return e.div;if(mxUtils.isNode(e.value)&&"userobject"==e.value.nodeName.toLowerCase()){var t=document.createElement("div"),n=e.getAttribute("label");return void 0==n&&(n=""),t.innerHTML=n,t}return""},new mxRubberband(u),d(),l();try{$("#"+a).bind("apexrefresh",function(){console.log(a),$("#"+a).is(":visible")&&d()})}catch(t){e.debug.error("Can't bind refresh event on "+g+". Apex is missing"),e.debug.error(t)}c.refresh>0&&setInterval(function(){$(g).is(":visible")&&d()},1e3*c.refresh),e.isAPEX()?($(window).on("apexwindowresized",function(){l()}),$("#t_TreeNav").on("theme42layoutchanged",function(){l()}),setInterval(function(){!f.is(":visible")||f.width()==f.find("svg").width()&&f.height()==f.find("svg").height()||l()},350)):$(window).resize(function(){l()})}}}();